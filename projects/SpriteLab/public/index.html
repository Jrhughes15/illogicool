<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Sprite Lab</title>
  <link rel="stylesheet" href="./style.css"/>
</head>
<body>
  <div class="topbar" id="topbar">
    <div class="left">
      <button id="btnNew" title="New project">New</button>
      <button id="btnOpen" title="Load local project">Load Local</button>
      <button id="btnSave" title="Save local project">Save Local</button>
      <span class="divider"></span>
      <button id="btnImportProject" title="Import project into workspace">Import Proj</button>
      <button id="btnExportProject" title="Export current project">Export Proj</button>
      <span class="divider"></span>
      <button id="btnImportAnimation" title="Import animation into this project">Import Anim</button>
      <button id="btnExportAnimation" title="Export current animation">Export Anim</button>
      <span class="divider"></span>
      <button id="openExportModal" title="Export sprite sheet or GIF">Export Sprite Sheet/Gif</button>
      <button id="openHelpModal" title="Open Sprite Lab help panel">Help</button>
      <span class="divider"></span>
      <button id="btnUndo" title="Undo last action">Undo</button>
      <button id="btnRedo" title="Redo last action">Redo</button>
    </div>
    <div class="center"></div>
    <div class="right">
      <input id="docTitle" class="doc-title-input" type="text" value="sprite_lab" aria-label="Project name"/>
      <span class="divider"></span>
      <span class="brand-badge">Sprite Lab</span>
    </div>
  </div>

  <input type="file" id="projectOpenInput" accept=".spritelab,.json,application/json" hidden />

  <div class="layout" id="layout">
    <aside class="tools" id="toolsPanel">
      <details class="side-section" data-section="tools" open>
        <summary>Tools</summary>
        <div class="section-body">
          <div class="tool-grid">
            <button data-tool="pencil" title="Pencil"><img src="icons/pencil.svg" alt="Pencil" /></button>
            <button data-tool="fill" title="Fill"><img src="icons/fill.svg" alt="Fill" /></button>
            <button data-tool="picker" title="Color picker"><img src="icons/eyedropper.svg" alt="Picker" /></button>
            <button data-tool="eraser" title="Eraser"><img src="icons/eraser.svg" alt="Eraser" /></button>
            <button data-tool="line" title="Line"><img src="icons/line.svg" alt="Line" /></button>
            <button data-tool="rect" title="Rectangle"><img src="icons/rectangle.svg" alt="Rectangle" /></button>
            <button data-tool="ellipse" title="Ellipse"><img src="icons/ellipse.svg" alt="Ellipse" /></button>
            <button data-tool="move" title="Move"><img src="icons/move.svg" alt="Move" /></button>
            <button data-tool="mirrorx" title="Mirror X"><img src="icons/MirrorX.svg" alt="Mirror X" /></button>
            <button data-tool="mirrory" title="Mirror Y"><img src="icons/MirrorY.svg" alt="Mirror Y" /></button>
            <button data-tool="select" title="Select"><img src="icons/select.svg" alt="Select" /></button>
            <button data-tool="lasso" title="Lasso"><img src="icons/lasso.svg" alt="Lasso" /></button>
          </div>
          <div class="selection-clipboard selection-clipboard--inline" aria-label="Selection clipboard actions">
            <button id="selCutBtn" class="selection-btn" title="Cut selection" aria-label="Cut selection">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 6l8 6-8 6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="16" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                <circle cx="16" cy="16" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
            <button id="selCopyBtn" class="selection-btn" title="Copy selection" aria-label="Copy selection">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <rect x="7" y="7" width="11" height="13" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/>
                <path d="M5 11V5h10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
            <button id="selPasteBtn" class="selection-btn" title="Paste selection" aria-label="Paste selection">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M9 4h6l1 2h3v14H5V6h3z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                <path d="M9 11h6v5H9z" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
            <button id="selDeleteBtn" class="selection-btn" title="Delete selection" aria-label="Delete selection">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M5 7h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M9 7V5h6v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M7 7v11a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V7" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </div>
          <div class="tool-opts">
            <label>Brush
              <input id="brushSize" type="range" min="1" max="64" step="1" value="1"/>
            </label>
            <span id="brushSizeReadout">1 px</span>
          </div>
          <div class="tool-opts tool-opts--alpha">
            <label>Alpha
              <input id="brushAlpha" type="range" min="0" max="1" step="0.01" value="1"/>
            </label>
            <span id="brushAlphaReadout"><b>100%</b></span> 
          </div>
          <div class="colors">
            <h3>Colors</h3>
            <div class="swatches">
              <label>FG <input id="fgColor" type="color" value="#000000"/></label>
              <label>BG <input id="bgColor" type="color" value="#ffffff"/></label>
              <input id="hexInput" type="text" value="#000000"/>
            </div>
            <div id="colorHistory"></div>
          </div>
        </div>
      </details>
      <details class="side-section" data-section="import" open>
        <summary>Import</summary>
        <div class="section-body">
          <div class="import-actions">
            <button class="btn-full" id="importPng" title="Import PNG + Frame(s)">PNG + Frame</button>
            <button class="btn-full" id="importStrip" title="Import folder/sprite strip + Frames">Folder/Strip + Frames</button>
            <div class="import-inline">
              <label>Padding
                <input id="importPadding" type="number" min="0" max="64" value="0"/>
              </label>
              <label>Fit
                <select id="importFit">
                  <option value="contain" selected>Contain</option>
                  <option value="cover">Cover</option>
                  <option value="stretch">Stretch</option>
                  <option value="center">Center</option>
                </select>
              </label>
            </div>
          </div>
          <input type="file" id="importPngInput" accept="image/png" multiple hidden/>
          <input type="file" id="importStripInput" accept="image/png" multiple webkitdirectory directory hidden/>
        </div>
      </details>
      <details class="side-section" data-section="pivot" open>
        <summary class="pivot-summary">
          <span>Pivot</span>
          <span class="pivot-readout">
            <span id="pivotXReadout">X: 0</span>
            <span id="pivotYReadout">Y: 0</span>
          </span>
        </summary>
        <div class="section-body pivot-panel">
          <div class="pivot-row">
            <label class="pivot-toggle">
              <input id="pivotShowToggle" type="checkbox"/>
              Show Anchor
            </label>
            <label class="pivot-select" aria-label="Pivot anchor">
              <select id="pivotSelect">
                <option value="tl">TOP LFT</option>
                <option value="tc">TOP CEN</option>
                <option value="tr">TOP RGT</option>
                <option value="cl">CTR LFT</option>
                <option value="c">CENTER</option>
                <option value="cr">CTR RGT</option>
                <option value="bl">BOT LFT</option>
                <option value="bc">BOT CEN</option>
                <option value="br">BOT RGT</option>
                <option value="custom">CUSTOM</option>
              </select>
            </label>
          </div>
        </div>
      </details>
    </aside>

    <section class="stage" id="stage">
      <details class="side-section canvas-panel" data-section="canvas" open>
        <summary>Canvas</summary>
        <div class="section-body">
          <div class="canvas-controls">
            <div class="canvas-controls-row">
              <div class="canvas-zoom-group">
                <button id="zoomOutBtn" data-zoom="-1" aria-label="Zoom out" title="Zoom out">-</button>
                <span id="zoomReadout" title="Current zoom">300%</span>
                <button id="zoomInBtn" data-zoom="+1" aria-label="Zoom in" title="Zoom in">+</button>
                <button id="fitBtn" data-action="fit" title="Fit canvas to viewport">Fit</button>
                <button id="oneXBtn" data-action="oneX" title="View at 1x">1x</button>
                <div class="canvas-toggle-group">
                  <label title="Show onion skins"><input id="onionToggle" type="checkbox"> Onion</label>
                  <label title="Show checker background"><input id="checkerToggle" type="checkbox" checked> Checker</label>
                </div>
              </div>
              <div class="canvas-size-group">
                <label title="Canvas width (px)">W <input id="sizeW" type="number" min="1" max="4096" value="128"></label>
                <label title="Canvas height (px)">H <input id="sizeH" type="number" min="1" max="4096" value="128"></label>
                <button id="applySize" title="Apply canvas size">Apply</button>
              </div>
            </div>
          </div>
          <div id="canvasWrap" class="canvas-wrap">
            <div class="canvas-stack">
              <div id="artboardBg" aria-hidden="true" class="checker"></div>
              <canvas id="onionCanvas" width="128" height="128" aria-hidden="true"></canvas>
              <canvas id="drawCanvas" width="128" height="128"></canvas>
              <canvas id="pivotCanvas" width="128" height="128" aria-hidden="true"></canvas>
              <canvas id="overlayCanvas" width="128" height="128" aria-hidden="true"></canvas>
            </div>
          </div>
        </div>
      </details>
      <details class="side-section frames-panel" data-section="frames" open>
        <summary>Frames</summary>
        <div class="section-body">
          <div class="frames-footer">
            <div class="frames-toolbar">
              <div class="group">
                <div class="timeline-actions">
                  <button id="frameAddBtn" title="Add frame">+</button>
                  <button id="frameDupBtn" title="Duplicate frame">Dup</button>
                  <button id="frameDelBtn" title="Delete frame">Del</button>
                </div>
              </div>
              <span class="divider"></span>
              <div class="group">
                <button id="frameMoveLeftBtn" title="Move frame left"><img src="icons/frame-left.svg" alt="Move left"/></button>
                <span class="toolbar-label">Reorder</span>
                <button id="frameMoveRightBtn" title="Move frame right"><img src="icons/frame-right.svg" alt="Move right"/></button>
              </div>
              <span class="divider"></span>
              <div class="group">
                <button id="framePrevBtn" title="Previous frame"><img src="icons/frame-prev.svg" alt="Previous"/></button>
                <span class="toolbar-label">Cycle</span>
                <button id="frameNextBtn" title="Next frame"><img src="icons/frame-next.svg" alt="Next"/></button>
              </div>
              <span class="divider"></span>
              <div class="group frame-edit-group">
                <button id="frameFlipBtn" title="Flip frame (Alt=vertical)">Flip</button>
                <button id="frameRotateBtn" title="Rotate frame clockwise (Alt=counterclockwise)">Rotate</button>
                <button id="frameCopyBtn" title="Copy frame">Copy</button>
                <button id="framePasteBtn" title="Paste frame">Paste</button>
              </div>
              <span class="divider"></span>
              <div class="group" id="onionSettings">
                <div class="onion-inline">
                  <label><span class="toolbar-label">Onion</span>Prev <input id="onionPrev" type="number" min="0" max="5" value="1"/></label>
                  <label>Next <input id="onionNext" type="number" min="0" max="5" value="1"/></label>
                  <label class="onion-opacity-inline">Opacity
                    <input id="onionOpacity" type="number" min="5" max="100" value="35"/>
                    <span>%</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="frame-strip" id="frameStrip">
            <div class="frame active">
              <canvas width="32" height="32"></canvas>
              <div class="name">1</div>
            </div>
          </div>
          
        </div>
      </details>
    </section>

    <aside class="sidepanel" id="rightPanel">
      <details class="side-section" data-section="animations" open>
        <summary class="panel-summary">
          <span>Animations</span>
          <span class="panel-meta" id="activeAnimationLabel">--</span>
        </summary>
        <div class="section-body">
          <div class="animation-actions">
            <button id="animAddBtn" title="Add animation">+</button>
            <button id="animDupBtn" title="Duplicate animation">Dup</button>
            <button id="animDelBtn" title="Delete animation">Del</button>
          </div>
          <ul class="animation-list" id="animationList"></ul>
        </div>
      </details>
      <details class="side-section" data-section="layers" open>
        <summary class="panel-summary">
          <span>Layers</span>
          <span class="panel-meta" id="activeLayerLabel">--</span>
        </summary>
        <div class="section-body">
          <div class="layer-actions">
            <button id="layerAdd" title="Add layer"><img src="icons/layer-add.svg" alt="Add"/></button>
            <button id="layerDup" title="Duplicate layer"><img src="icons/layer-duplicate.svg" alt="Dup"/></button>
            <button id="layerCloneAll" title="Clone active layer to all frames"><img src="icons/layer-clone-all.svg" alt="Clone"/></button>
            <button id="layerDel" title="Delete layer"><img src="icons/layer-delete.svg" alt="Delete"/></button>
            <button id="layerMoveUp" title="Move layer up"><img src="icons/layer-up.svg" alt="Up"/></button>
            <button id="layerMoveDown" title="Move layer down"><img src="icons/layer-down.svg" alt="Down"/></button>
            <button id="layerMergeDown" title="Merge down"><img src="icons/layer-merge.svg" alt="Merge"/></button>
          </div>
          <ul class="layer-list" id="layerList">
            <li class="layer-item">
              <div class="layer-top">
                <div class="layer-flags">
                  <button type="button" data-layer-action="toggle-visible">??</button>
                  <button type="button" data-layer-action="toggle-lock">??</button>
                </div>
                <input class="layer-name" value="Base" />
                <label class="layer-opacity-wrap">
                  <input class="layer-opacity" type="number" min="0" max="100" value="100" />
                  <span>%</span>
                </label>
              </div>
            </li>
          </ul>
        </div>
      </details>
      <details class="side-section" data-section="preview" open>
        <summary>Preview</summary>
        <div class="section-body">
          <div class="preview-controls">
            <div class="preview-row preview-row--primary">
              <button id="playBtn" title="Play/Stop" class="play-btn" aria-label="Play or stop preview"></button>
              <div class="preview-modes" role="group" aria-label="Playback mode">
                <button type="button" data-preview-mode="loop" class="preview-mode-btn active">Loop</button>
                <button type="button" data-preview-mode="pingpong" class="preview-mode-btn">Ping&nbsp;Pong</button>
              </div>
              <label class="preview-speed">FPS
                <input id="previewFps" type="number" min="1" max="60" placeholder="12" />
              </label>
            </div>
          </div>
          <div class="preview-stage" id="previewStage">
            <canvas id="previewCanvas" width="229.88" height="229.88"></canvas>
          </div>
        </div>
      </details>
    </aside>
  </div>

  <div class="statusbar" id="statusBar">
    <span id="statusLeft">Ready.</span>
    <span id="statusCenter"></span>
    <span id="statusRight">Select a tool for info.</span>
  </div>

  <div class="modal" id="exportModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="exportModalTitle">
    <div class="modal-backdrop" data-modal-close></div>
    <div class="modal-dialog" role="document" tabindex="-1">
      <div class="modal-header">
        <div class="modal-heading">
          <h2 id="exportModalTitle">Export sprite sheet</h2>
          <p class="modal-subtitle">Configure formats, padding, and scales before downloading.</p>
        </div>
        <button type="button" class="modal-close" id="closeExportModal" data-modal-close aria-label="Close export dialog">Close</button>
      </div>
      <div class="modal-body">
        <p class="modal-lede">Sprite Lab exports the active animation by default. Use Advanced to include entire projects, combined sheets, and multi-scale PNGs.</p>
        <div class="export-layout">
          <section class="export-section export-section--grid">
            <div class="form-field">
              <div class="field-heading">
                <span class="field-title">Format</span>
                <span class="field-hint">PNG for final builds, WebP/JPEG for previews, GIF for direct sharing.</span>
              </div>
              <select id="exportFormat">
                <option value="png" selected>PNG Sheet (lossless)</option>
                <option value="webp">WebP Sheet (smaller)</option>
                <option value="jpeg">JPEG Preview</option>
                <option value="gif">Animated GIF only</option>
              </select>
            </div>
            <div class="form-field">
              <div class="field-heading">
                <span class="field-title">Meta</span>
                <span class="field-hint">Attach metadata for engines that read Aseprite JSON.</span>
              </div>
              <select id="exportMeta">
                <option value="aseprite">Aseprite JSON</option>
              </select>
            </div>
            <div class="form-field">
              <div class="field-heading">
                <span class="field-title">Sheet size</span>
                <span class="field-hint">Force a target atlas dimension or stay on auto.</span>
              </div>
              <select id="exportSheetSize">
                <option value="0" selected>Auto wrap</option>
                <option value="256">256 px</option>
                <option value="512">512 px</option>
                <option value="1024">1024 px</option>
                <option value="2048">2048 px</option>
                <option value="4096">4096 px</option>
              </select>
            </div>
            <div class="form-field">
              <div class="field-heading">
                <span class="field-title">Padding</span>
                <span class="field-hint">Blank pixels between frames.</span>
              </div>
              <input id="exportPadding" type="number" min="0" max="16" value="2"/>
            </div>
            <div class="form-field">
              <div class="field-heading">
                <span class="field-title">Extrude</span>
                <span class="field-hint">Extends edge pixels to avoid seams.</span>
              </div>
              <input id="exportExtrude" type="number" min="0" max="8" value="2"/>
            </div>
            <div class="form-field form-field--checkbox">
              <div class="field-heading">
                <span class="field-title">Power of two</span>
                <span class="field-hint">Snap width/height to the next 2<sup>n</sup>.</span>
              </div>
              <label class="checkbox-pill">
                <input id="exportPot" type="checkbox"/>
                <span>PO2 only</span>
              </label>
            </div>
          </section>
          <section class="export-section export-section--side">
            <div class="export-scales" id="exportVariants">
              <div class="field-heading">
                <span class="field-title">Scales</span>
                <span class="field-hint">Choose the resolution sets you need.</span>
              </div>
              <div class="scale-options">
                <label><input type="checkbox" class="export-variant" data-scale="1" checked/>1x</label>
                <label><input type="checkbox" class="export-variant" data-scale="2"/>2x</label>
                <label><input type="checkbox" class="export-variant" data-scale="3"/>3x</label>
                <label><input type="checkbox" class="export-variant" data-scale="4"/>4x</label>
              </div>
            </div>
            <div class="export-extras">
              <div class="field-heading">
                <span class="field-title">Extras</span>
                <span class="field-hint">Optional files added to the ZIP.</span>
              </div>
              <label class="export-toggle">
                <input type="checkbox" id="exportIncludeGif" checked/>
                <span>
                  <strong>GIF preview</strong>
                  <em>Looping preview at the first scale.</em>
                </span>
              </label>
              <label class="export-toggle">
                <input type="checkbox" id="exportFramePngs"/>
                <span>
                  <strong>Frame PNGs</strong>
                  <em>One PNG per frame for each scale.</em>
                </span>
              </label>
              <label class="export-toggle">
                <input type="checkbox" id="exportPaletteFile" checked/>
                <span>
                  <strong>Palette files</strong>
                  <em>Save your current palette as GPL/JSON.</em>
                </span>
              </label>
              <label class="export-toggle">
                <input type="checkbox" id="exportAnimationSummary" checked/>
                <span>
                  <strong>Animation summary</strong>
                  <em>JSON overview for durations and pivots.</em>
                </span>
              </label>
            </div>
          </section>
        </div>
        <div class="form-actions">
          <button class="export-btn" id="quickSheetBtn">Quick sheet</button>
          <button class="export-btn ghost" id="advancedBtn">Advanced?</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="helpModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="helpModalTitle">
    <div class="modal-backdrop" data-modal-close></div>
    <div class="modal-dialog modal-dialog--narrow" role="document" tabindex="-1">
      <div class="modal-header">
        <div class="modal-heading">
          <h2 id="helpModalTitle">Sprite Lab help</h2>
          <p class="modal-subtitle">Quick tips for building, editing, and exporting sprites.</p>
        </div>
        <button type="button" class="modal-close" id="closeHelpModal" data-modal-close aria-label="Close help dialog">Close</button>
      </div>
      <div class="modal-body">
        <p class="modal-lede">Need a refresher? These highlights walk through the core workflow.</p>
        <div class="modal-section">
          <h3>Getting started</h3>
          <ul class="modal-list">
            <li><span class="list-label">New/Load:</span> Use the top bar to start a new sprite or load your browser save. Use Import/Export for `.spritelab` files.</li>
            <li><span class="list-label">Import frames:</span> Drop PNGs into the Frames panel or use Import Anim to bring JSON animations back in.</li>
            <li><span class="list-label">Toolbox:</span> Pick from pencil, fill, select, lasso, or move on the left toolbar.</li>
          </ul>
        </div>
        <div class="modal-section">
          <h3>Canvas & timeline tips</h3>
          <ul class="modal-list">
            <li><span class="list-label">Shortcuts:</span> Ctrl/Cmd+Z to undo, Shift+scroll to zoom, and Enter/Esc to confirm or cancel active selections.</li>
            <li><span class="list-label">Frames:</span> The timeline supports drag-to-reorder; click + to duplicate the current frame.</li>
            <li><span class="list-label">Layers:</span> Toggle visibility/lock icons in the Layers panel to focus on one piece at a time.</li>
          </ul>
        </div>
        <div class="modal-section">
          <h3>Export workflow</h3>
          <ul class="modal-list">
            <li><span class="list-label">Quick sheet:</span> Packs the active animation at the first checked scale.</li>
            <li><span class="list-label">Advanced:</span> Includes all animations, combined sheets, GIFs, palettes, and metadata.</li>
            <li><span class="list-label">Status:</span> Watch the footer for progress/errors during long exports.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="../src/main.js"></script>
</body>
</html>



